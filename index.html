<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chord Keypad</title>
    <link rel="stylesheet" href="style.css" />
    <!-- Using esm.sh for module loading -->
    <script type="importmap">
      {
        "imports": {
          "bg-tone": "https://esm.sh/tone@14.7.77",
          "bg-tonal": "https://esm.sh/@tonaljs/tonal@4.10.0",
          "bg-voice-leading": "https://esm.sh/@tonaljs/voice-leading@4.10.0",
          "bg-voicing": "https://esm.sh/@tonaljs/voicing@4.10.0"
        }
      }
    </script>
  </head>
  <body>
    <div id="app">
      <header>
        <div class="title-row">
          <h1>Chord Keypad</h1>
          <button id="help-btn" aria-label="Help">?</button>
        </div>
        <p>Press keys 1-7 to play chords in the scale</p>
      </header>

      <div class="controls">
        <div class="key-selector">
          <label for="root-note">Key:</label>
          <select id="root-note">
            <option value="C">C</option>
            <option value="Db">Db</option>
            <option value="D">D</option>
            <option value="Eb">Eb</option>
            <option value="E">E</option>
            <option value="F">F</option>
            <option value="Gb">Gb</option>
            <option value="G">G</option>
            <option value="Ab">Ab</option>
            <option value="A">A</option>
            <option value="Bb">Bb</option>
            <option value="B">B</option>
          </select>
        </div>
        <div class="toggle-control">
          <input type="checkbox" id="voice-leading-toggle" checked />
          <label for="voice-leading-toggle">Enable Voice Leading</label>
        </div>
      </div>

      <div class="display">
        <button id="start-audio">
          Start Audio Engine
          <span style="font-size: 0.8em; opacity: 0.8; font-weight: normal"
            >(Press Enter)</span
          >
        </button>
        <div id="chord-info-container" style="display: none">
          <h2 id="current-chord">-</h2>
          <div id="notes-display"></div>
        </div>
      </div>

      <div class="keypad">
        <div class="key" data-note="1">
          1
          <div>I</div>
        </div>
        <div class="key" data-note="2">
          2
          <div>ii</div>
        </div>
        <div class="key" data-note="3">
          3
          <div>iii</div>
        </div>
        <div class="key" data-note="4">
          4
          <div>IV</div>
        </div>
        <div class="key" data-note="5">
          5
          <div>V</div>
        </div>
        <div class="key" data-note="6">
          6
          <div>vi</div>
        </div>
        <div class="key" data-note="7">
          7
          <div>vii°</div>
        </div>
      </div>

      <div class="instructions">
        <h3>Modifiers (Hold + Key)</h3>
        <div class="modifier-grid">
          <div class="mod-item" id="mod-major">
            <span class="key-badge">⏎</span> <span>Major Triad</span>
          </div>
          <div class="mod-item" id="mod-minor">
            <span class="key-badge">-</span> <span>Minor Triad</span>
          </div>
          <div class="mod-item" id="mod-dominant">
            <span class="key-badge">d</span> <span class="key-badge">/</span>
            <span>Dominant 7th</span>
          </div>
          <div class="mod-item" id="mod-majorSixth">
            <span class="key-badge">s</span> <span class="key-badge">8</span>
            <span>Major 6th</span>
          </div>
          <div class="mod-item" id="mod-majorSeventh">
            <span class="key-badge">m</span> <span class="key-badge">9</span>
            <span>Major 7th</span>
          </div>
          <div class="mod-item" id="mod-diminished">
            <span class="key-badge">o</span> <span class="key-badge">*</span>
            <span>Diminished 7th</span>
          </div>
          <div class="mod-item" id="mod-augmented">
            <span class="key-badge">+</span> <span class="key-badge">=</span>
            <span>Augmented 7th</span>
          </div>
          <div class="mod-item" id="mod-halfDiminished">
            <span class="key-badge">␛</span> <span class="key-badge">␡</span>
            <span>Half-Diminished</span>
          </div>
        </div>
        <h3>Root Note Modifiers (Hold + Key)</h3>
        <div class="modifier-grid">
          <div class="mod-item" id="mod-rootShiftDown">
            <span class="key-badge">,</span> <span class="key-badge">0</span>
            <span>Flat Root (b)</span>
          </div>
          <div class="mod-item" id="mod-rootShiftUp">
            <span class="key-badge">.</span> <span class="key-badge">></span>
            <span>Sharp Root (#)</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button id="close-modal" aria-label="Close">&times;</button>
        <h2>How to Use Chord Keypad</h2>
        <p>
          <strong>Chord Keypad</strong> turns your keyboard number keys (1-7)
          into a chordal musical instrument. It is designed to be used with a
          numerical keypad layout, but it can also be used with a standard
          keyboard.
        </p>

        <ul>
          <li>
            <strong>Play Chords:</strong> Press <code>1-7</code> to play
            diatonic triads in the selected key.
          </li>
          <li>
            <strong>Sustain:</strong> Hold a number key to sustain the chord.
          </li>
          <li>
            <strong>Modify:</strong> Hold a modifier key (like
            <code>d</code> for Dominant 7th) while playing to change the chord
            quality.
          </li>
          <li>
            <strong>Hot-Swap:</strong> Change modifiers while holding a chord to
            shift it instantly!
          </li>
          <li>
            <strong>Voice Leading:</strong> Tries to move notes as little as
            possible between chords for a smooth sound.
          </li>
          <li>
            <strong>Change keys:</strong> Use the dropdown to change keys, or
            hold <code>Enter</code> and press <code>+</code> or <code>-</code>
            to shift the key up or down chromatically.
          </li>
        </ul>

        <div class="modal-footer">
          <p>
            Check the instructions on the bottom of the page for the full list
            of modifier keys.
          </p>
        </div>
      </div>
    </div>

    <script type="module" src="app.js"></script>
  </body>
</html>
